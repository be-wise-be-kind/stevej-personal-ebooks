\raggedbottom

% Prevent widows and orphans (minimum 2 lines before/after page break)
\widowpenalty=10000
\clubpenalty=10000
\usepackage{fancyhdr}
\usepackage[table]{xcolor}
\usepackage{float}
\usepackage{booktabs}

% Table styling - alternating row colors for readability
\definecolor{tablerowgray}{RGB}{245,245,245}
\let\oldlongtable\longtable
\let\endoldlongtable\endlongtable
\renewenvironment{longtable}{\rowcolors{2}{white}{tablerowgray}\oldlongtable}{\endoldlongtable}

% Add more padding to table cells
\renewcommand{\arraystretch}{1.4}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\textcolor{gray}{\leftmark}}
\fancyhead[R]{\textcolor{gray}{\thepage}}
\fancyfoot{}
\renewcommand{\headrulewidth}{0pt}
\setlength{\headsep}{20pt}

% Prevent figures from floating - keep them where defined
% [section] option adds \FloatBarrier at each section boundary
\usepackage[section]{placeins}
\floatplacement{figure}{H}

% Force even stricter float placement
\makeatletter
\renewcommand{\fps@figure}{H}
\makeatother

% Scale large images to fit on page
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>0.8\textheight 0.8\textheight\else\Gin@nat@height\fi}
\makeatother
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}

% Add more space between sections (before}{after)
\usepackage{titlesec}
\titlespacing*{\section}{0pt}{5ex plus 1ex minus .2ex}{3ex plus .2ex}
\titlespacing*{\subsection}{0pt}{4ex plus 1ex minus .2ex}{2.5ex plus .2ex}
\titlespacing*{\subsubsection}{0pt}{3ex plus 1ex minus .2ex}{2ex plus .2ex}

% Add space between paragraphs
\setlength{\parskip}{0.8em}

% Style code blocks with background color
\usepackage{framed}
\usepackage{mdframed}
\definecolor{codebg}{RGB}{245,245,245}
\surroundwithmdframed[
  backgroundcolor=codebg,
  linewidth=0pt,
  innerleftmargin=10pt,
  innerrightmargin=10pt,
  innertopmargin=10pt,
  innerbottommargin=10pt
]{verbatim}
\surroundwithmdframed[
  backgroundcolor=codebg,
  linewidth=0pt,
  innerleftmargin=10pt,
  innerrightmargin=10pt,
  innertopmargin=10pt,
  innerbottommargin=10pt
]{Highlighting}
