<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Latency Distribution: Why Averages Lie</title>
    <style>
        body {
            font-family: Liberation Sans, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8fafc;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .diagram-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 24px;
            max-width: 100%;
        }
        svg {
            display: block;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="diagram-container">
        <svg viewBox="0 0 920 730" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <!-- Gradient for the distribution curve fill -->
                <linearGradient id="distGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:0.6" />
                    <stop offset="100%" style="stop-color:#3b82f6;stop-opacity:0.1" />
                </linearGradient>

                <!-- Gradient for tail section -->
                <linearGradient id="tailGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#ef4444;stop-opacity:0.6" />
                    <stop offset="100%" style="stop-color:#ef4444;stop-opacity:0.1" />
                </linearGradient>

                <!-- Arrow marker -->
                <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#64748b"/>
                </marker>

                <marker id="arrowheadRed" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#ef4444"/>
                </marker>
            </defs>

            <!-- Background -->
            <rect width="920" height="680" fill="#ffffff" rx="12"/>

            <!-- Main Title -->
            <text x="460" y="40" text-anchor="middle" fill="#1e293b" font-size="24" font-weight="600">
                Latency Distribution: Why Averages Lie
            </text>

            <!-- Section 1: The Misleading Average -->
            <g transform="translate(50, 85)">
                <rect width="380" height="250" fill="#fef2f2" rx="8" stroke="#fecaca" stroke-width="2"/>

                <text x="190" y="35" text-anchor="middle" fill="#991b1b" font-size="16" font-weight="600">
                    The Misleading Average
                </text>

                <!-- Simple bar representation -->
                <g transform="translate(40, 70)">
                    <!-- Average marker -->
                    <rect x="0" y="0" width="300" height="115" fill="#fff7ed" rx="4"/>

                    <!-- Individual request dots showing distribution -->
                    <g>
                        <!-- 99 fast requests clustered together -->
                        <circle cx="30" cy="55" r="6" fill="#3b82f6"/>
                        <circle cx="45" cy="50" r="6" fill="#3b82f6"/>
                        <circle cx="35" cy="65" r="6" fill="#3b82f6"/>
                        <circle cx="50" cy="60" r="6" fill="#3b82f6"/>
                        <circle cx="40" cy="45" r="6" fill="#3b82f6"/>
                        <circle cx="55" cy="53" r="6" fill="#3b82f6"/>
                        <circle cx="60" cy="63" r="6" fill="#3b82f6"/>
                        <circle cx="25" cy="57" r="6" fill="#3b82f6"/>
                        <circle cx="48" cy="70" r="6" fill="#3b82f6"/>
                        <circle cx="38" cy="40" r="6" fill="#3b82f6"/>
                        <circle cx="65" cy="47" r="6" fill="#3b82f6"/>
                        <circle cx="52" cy="43" r="6" fill="#3b82f6"/>

                        <!-- 1 slow request far to the right -->
                        <circle cx="270" cy="55" r="8" fill="#ef4444" stroke="#b91c1c" stroke-width="2"/>
                    </g>

                    <!-- Labels -->
                    <text x="45" y="100" text-anchor="middle" fill="#1e40af" font-size="11" font-weight="500">99 requests @ 10ms</text>
                    <text x="270" y="100" text-anchor="middle" fill="#b91c1c" font-size="11" font-weight="500">1 request @ 1000ms</text>

                    <!-- Average line - positioned to avoid overlapping labels -->
                    <line x1="125" y1="0" x2="125" y2="115" stroke="#f97316" stroke-width="3" stroke-dasharray="6"/>
                    <text x="125" y="132" text-anchor="middle" fill="#c2410c" font-size="12" font-weight="600">Average: 19.9ms</text>
                </g>

                <!-- Warning text -->
                <text x="190" y="225" text-anchor="middle" fill="#991b1b" font-size="12" font-style="italic">
                    The "average user" (19.9ms) does not exist!
                </text>
            </g>

            <!-- Section 2: The Full Picture with Percentiles -->
            <g transform="translate(470, 85)">
                <rect width="400" height="265" fill="#f0fdf4" rx="8" stroke="#bbf7d0" stroke-width="2"/>

                <text x="190" y="35" text-anchor="middle" fill="#166534" font-size="16" font-weight="600">
                    The Full Picture: Percentiles
                </text>

                <!-- Percentile boxes -->
                <g transform="translate(30, 60)">
                    <rect width="75" height="80" fill="#dcfce7" rx="6"/>
                    <text x="37" y="30" text-anchor="middle" fill="#166534" font-size="14" font-weight="700">p50</text>
                    <text x="37" y="58" text-anchor="middle" fill="#15803d" font-size="16" font-weight="600">10ms</text>

                    <rect x="85" width="75" height="80" fill="#dcfce7" rx="6"/>
                    <text x="122" y="30" text-anchor="middle" fill="#166534" font-size="14" font-weight="700">p95</text>
                    <text x="122" y="58" text-anchor="middle" fill="#15803d" font-size="16" font-weight="600">10ms</text>

                    <rect x="170" width="75" height="80" fill="#fef9c3" rx="6"/>
                    <text x="207" y="30" text-anchor="middle" fill="#854d0e" font-size="14" font-weight="700">p99</text>
                    <text x="207" y="58" text-anchor="middle" fill="#a16207" font-size="16" font-weight="600">1000ms</text>

                    <rect x="255" width="75" height="80" fill="#fee2e2" rx="6"/>
                    <text x="292" y="30" text-anchor="middle" fill="#991b1b" font-size="14" font-weight="700">Max</text>
                    <text x="292" y="58" text-anchor="middle" fill="#b91c1c" font-size="16" font-weight="600">1000ms</text>
                </g>

                <!-- Interpretation -->
                <g transform="translate(30, 160)">
                    <rect width="320" height="85" fill="#ffffff" rx="6" stroke="#86efac" stroke-width="1"/>
                    <text x="160" y="24" text-anchor="middle" fill="#166534" font-size="12" font-weight="600">What this tells us:</text>
                    <text x="160" y="45" text-anchor="middle" fill="#475569" font-size="11">50% of users: excellent (10ms)</text>
                    <text x="160" y="62" text-anchor="middle" fill="#475569" font-size="11">95% of users: excellent (10ms)</text>
                    <text x="160" y="79" text-anchor="middle" fill="#dc2626" font-size="11" font-weight="500">1% of users: terrible (1000ms)</text>
                </g>
            </g>

            <!-- Main Distribution Chart -->
            <g transform="translate(50, 375)">
                <rect width="820" height="330" fill="#f8fafc" rx="8" stroke="#e2e8f0" stroke-width="1"/>

                <text x="410" y="35" text-anchor="middle" fill="#1e293b" font-size="16" font-weight="600">
                    Long-Tail Latency Distribution with Percentile Markers
                </text>

                <!-- Chart area -->
                <g transform="translate(70, 60)">
                    <!-- Y-axis -->
                    <line x1="0" y1="0" x2="0" y2="210" stroke="#94a3b8" stroke-width="2"/>
                    <text x="-10" y="110" text-anchor="middle" fill="#64748b" font-size="12" transform="rotate(-90, -10, 110)">
                        Request Count
                    </text>
                    <text x="-5" y="8" text-anchor="end" fill="#64748b" font-size="10">High</text>
                    <text x="-5" y="210" text-anchor="end" fill="#64748b" font-size="10">Low</text>

                    <!-- X-axis -->
                    <line x1="0" y1="210" x2="680" y2="210" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrowhead)"/>
                    <text x="340" y="250" text-anchor="middle" fill="#64748b" font-size="12">
                        Response Time (ms)
                    </text>

                    <!-- X-axis labels -->
                    <text x="0" y="228" text-anchor="middle" fill="#64748b" font-size="10">0</text>
                    <text x="80" y="228" text-anchor="middle" fill="#64748b" font-size="10">10</text>
                    <text x="160" y="228" text-anchor="middle" fill="#64748b" font-size="10">50</text>
                    <text x="280" y="228" text-anchor="middle" fill="#64748b" font-size="10">100</text>
                    <text x="400" y="228" text-anchor="middle" fill="#64748b" font-size="10">200</text>
                    <text x="520" y="228" text-anchor="middle" fill="#64748b" font-size="10">500</text>
                    <text x="640" y="228" text-anchor="middle" fill="#ef4444" font-size="10" font-weight="600">1000+</text>

                    <!-- Distribution curve - main body (fast requests) -->
                    <path d="M0,210
                             C20,210 40,190 60,105
                             C70,65 75,35 80,25
                             C85,15 90,13 100,20
                             C110,30 120,55 140,95
                             C160,135 180,165 200,180
                             C220,190 250,197 280,200
                             L280,210 Z"
                          fill="url(#distGradient)" stroke="#3b82f6" stroke-width="2"/>

                    <!-- Long tail (slow requests) -->
                    <path d="M280,200
                             C320,202 360,203 400,203.5
                             C450,204 500,204.2 550,204.5
                             C600,204.7 640,204.8 660,204.9
                             L660,210 L280,210 Z"
                          fill="url(#tailGradient)" stroke="#ef4444" stroke-width="2"/>

                    <!-- p50 marker -->
                    <line x1="80" y1="15" x2="80" y2="210" stroke="#22c55e" stroke-width="2" stroke-dasharray="6"/>
                    <rect x="55" y="8" width="50" height="24" fill="#22c55e" rx="4"/>
                    <text x="80" y="25" text-anchor="middle" fill="#ffffff" font-size="11" font-weight="600">p50</text>
                    <text x="80" y="-5" text-anchor="middle" fill="#166534" font-size="10" font-weight="500">10ms</text>

                    <!-- p95 marker -->
                    <line x1="200" y1="15" x2="200" y2="210" stroke="#eab308" stroke-width="2" stroke-dasharray="6"/>
                    <rect x="175" y="8" width="50" height="24" fill="#eab308" rx="4"/>
                    <text x="200" y="25" text-anchor="middle" fill="#ffffff" font-size="11" font-weight="600">p95</text>
                    <text x="200" y="-5" text-anchor="middle" fill="#854d0e" font-size="10" font-weight="500">85ms</text>

                    <!-- p99 marker -->
                    <line x1="400" y1="15" x2="400" y2="210" stroke="#f97316" stroke-width="2" stroke-dasharray="6"/>
                    <rect x="375" y="8" width="50" height="24" fill="#f97316" rx="4"/>
                    <text x="400" y="25" text-anchor="middle" fill="#ffffff" font-size="11" font-weight="600">p99</text>
                    <text x="400" y="-5" text-anchor="middle" fill="#c2410c" font-size="10" font-weight="500">210ms</text>

                    <!-- p99.9 marker -->
                    <line x1="560" y1="15" x2="560" y2="210" stroke="#ef4444" stroke-width="2" stroke-dasharray="6"/>
                    <rect x="530" y="8" width="60" height="24" fill="#ef4444" rx="4"/>
                    <text x="560" y="25" text-anchor="middle" fill="#ffffff" font-size="11" font-weight="600">p99.9</text>
                    <text x="560" y="-5" text-anchor="middle" fill="#b91c1c" font-size="10" font-weight="500">890ms</text>

                    <!-- Average marker (misleading) -->
                    <line x1="130" y1="50" x2="130" y2="210" stroke="#a855f7" stroke-width="3" stroke-dasharray="3"/>
                    <rect x="95" y="43" width="70" height="26" fill="#a855f7" rx="4"/>
                    <text x="130" y="61" text-anchor="middle" fill="#ffffff" font-size="10" font-weight="600">AVG: 45ms</text>

                    <!-- Annotation showing the problem -->
                    <g transform="translate(450, 100)">
                        <rect x="0" y="0" width="200" height="95" fill="#fef2f2" rx="6" stroke="#fecaca" stroke-width="1"/>
                        <text x="100" y="24" text-anchor="middle" fill="#991b1b" font-size="11" font-weight="600">The "Long Tail"</text>
                        <text x="100" y="46" text-anchor="middle" fill="#64748b" font-size="10">Only 1% of requests, but</text>
                        <text x="100" y="63" text-anchor="middle" fill="#64748b" font-size="10">at 10,000 RPS = 100 users/sec</text>
                        <text x="100" y="82" text-anchor="middle" fill="#dc2626" font-size="10" font-weight="500">suffering poor latency!</text>
                    </g>
                </g>
            </g>
        </svg>
    </div>
</body>
</html>
