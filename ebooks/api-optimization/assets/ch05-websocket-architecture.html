<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Server Architecture</title>
    <style>
        body {
            font-family: Liberation Sans, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8fafc;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .diagram-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 24px;
            max-width: 100%;
        }
        svg {
            display: block;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="diagram-container">
        <svg viewBox="0 0 800 420" xmlns="http://www.w3.org/2000/svg">
            <!-- Background -->
            <rect width="800" height="420" fill="white"/>

            <!-- Title -->
            <text x="400" y="25" text-anchor="middle" style="font-size: 18px; font-weight: 600; fill: #1e293b;" font-family="Liberation Sans, Arial, sans-serif">WebSocket Server Architecture</text>
            <text x="400" y="45" text-anchor="middle" style="font-size: 12px; fill: #64748b;" font-family="Liberation Sans, Arial, sans-serif">Scaling with sticky sessions and pub/sub</text>

            <!-- Clients -->
            <g transform="translate(40, 100)">
                <text x="50" y="-10" text-anchor="middle" style="font-size: 12px; font-weight: 600; fill: #64748b;" font-family="Liberation Sans, Arial, sans-serif">Clients</text>

                <!-- Client icons -->
                <rect x="20" y="0" width="60" height="40" fill="#dbeafe" rx="4" stroke="#3b82f6" stroke-width="1"/>
                <text x="50" y="25" text-anchor="middle" style="font-size: 10px; fill: #1e40af;" font-family="Liberation Sans, Arial, sans-serif">Client 1</text>

                <rect x="20" y="60" width="60" height="40" fill="#dbeafe" rx="4" stroke="#3b82f6" stroke-width="1"/>
                <text x="50" y="85" text-anchor="middle" style="font-size: 10px; fill: #1e40af;" font-family="Liberation Sans, Arial, sans-serif">Client 2</text>

                <rect x="20" y="120" width="60" height="40" fill="#dbeafe" rx="4" stroke="#3b82f6" stroke-width="1"/>
                <text x="50" y="145" text-anchor="middle" style="font-size: 10px; fill: #1e40af;" font-family="Liberation Sans, Arial, sans-serif">Client 3</text>

                <rect x="20" y="180" width="60" height="40" fill="#dbeafe" rx="4" stroke="#3b82f6" stroke-width="1"/>
                <text x="50" y="205" text-anchor="middle" style="font-size: 10px; fill: #1e40af;" font-family="Liberation Sans, Arial, sans-serif">Client 4</text>

                <rect x="20" y="240" width="60" height="40" fill="#dbeafe" rx="4" stroke="#3b82f6" stroke-width="1"/>
                <text x="50" y="265" text-anchor="middle" style="font-size: 10px; fill: #1e40af;" font-family="Liberation Sans, Arial, sans-serif">Client 5</text>
            </g>

            <!-- Load Balancer -->
            <g transform="translate(180, 150)">
                <rect x="0" y="0" width="100" height="120" fill="#fef3c7" rx="8" stroke="#f59e0b" stroke-width="2"/>
                <text x="50" y="25" text-anchor="middle" style="font-size: 11px; font-weight: 600; fill: #92400e;" font-family="Liberation Sans, Arial, sans-serif">Load Balancer</text>
                <text x="50" y="55" text-anchor="middle" style="font-size: 10px; fill: #b45309;" font-family="Liberation Sans, Arial, sans-serif">Sticky</text>
                <text x="50" y="70" text-anchor="middle" style="font-size: 10px; fill: #b45309;" font-family="Liberation Sans, Arial, sans-serif">Sessions</text>
                <text x="50" y="100" text-anchor="middle" style="font-size: 9px; fill: #78716c;" font-family="Liberation Sans, Arial, sans-serif">(IP or Cookie)</text>
            </g>

            <!-- Connection arrows to LB -->
            <line x1="120" y1="120" x2="178" y2="180" stroke="#3b82f6" stroke-width="1.5"/>
            <line x1="120" y1="180" x2="178" y2="200" stroke="#3b82f6" stroke-width="1.5"/>
            <line x1="120" y1="240" x2="178" y2="220" stroke="#3b82f6" stroke-width="1.5"/>
            <line x1="120" y1="300" x2="178" y2="240" stroke="#3b82f6" stroke-width="1.5"/>
            <line x1="120" y1="360" x2="178" y2="260" stroke="#3b82f6" stroke-width="1.5"/>

            <!-- WebSocket Servers -->
            <g transform="translate(340, 90)">
                <text x="70" y="-10" text-anchor="middle" style="font-size: 12px; font-weight: 600; fill: #64748b;" font-family="Liberation Sans, Arial, sans-serif">WebSocket Servers</text>

                <!-- Server 1 -->
                <rect x="0" y="0" width="140" height="90" fill="#dcfce7" rx="6" stroke="#22c55e" stroke-width="2"/>
                <text x="70" y="20" text-anchor="middle" style="font-size: 11px; font-weight: 600; fill: #166534;" font-family="Liberation Sans, Arial, sans-serif">Server 1</text>
                <text x="70" y="40" text-anchor="middle" style="font-size: 9px; fill: #15803d;" font-family="Liberation Sans, Arial, sans-serif">Connections: 2</text>
                <rect x="15" y="50" width="25" height="25" fill="#86efac" rx="3"/>
                <text x="27" y="67" text-anchor="middle" style="font-size: 8px; fill: #166534;" font-family="Liberation Sans, Arial, sans-serif">C1</text>
                <rect x="50" y="50" width="25" height="25" fill="#86efac" rx="3"/>
                <text x="62" y="67" text-anchor="middle" style="font-size: 8px; fill: #166534;" font-family="Liberation Sans, Arial, sans-serif">C2</text>

                <!-- Server 2 -->
                <rect x="0" y="110" width="140" height="90" fill="#dcfce7" rx="6" stroke="#22c55e" stroke-width="2"/>
                <text x="70" y="130" text-anchor="middle" style="font-size: 11px; font-weight: 600; fill: #166534;" font-family="Liberation Sans, Arial, sans-serif">Server 2</text>
                <text x="70" y="150" text-anchor="middle" style="font-size: 9px; fill: #15803d;" font-family="Liberation Sans, Arial, sans-serif">Connections: 3</text>
                <rect x="15" y="160" width="25" height="25" fill="#86efac" rx="3"/>
                <text x="27" y="177" text-anchor="middle" style="font-size: 8px; fill: #166534;" font-family="Liberation Sans, Arial, sans-serif">C3</text>
                <rect x="50" y="160" width="25" height="25" fill="#86efac" rx="3"/>
                <text x="62" y="177" text-anchor="middle" style="font-size: 8px; fill: #166534;" font-family="Liberation Sans, Arial, sans-serif">C4</text>
                <rect x="85" y="160" width="25" height="25" fill="#86efac" rx="3"/>
                <text x="97" y="177" text-anchor="middle" style="font-size: 8px; fill: #166534;" font-family="Liberation Sans, Arial, sans-serif">C5</text>
            </g>

            <!-- Arrows from LB to servers -->
            <line x1="282" y1="190" x2="338" y2="145" stroke="#f59e0b" stroke-width="1.5" marker-end="url(#arrowOrange)"/>
            <line x1="282" y1="230" x2="338" y2="245" stroke="#f59e0b" stroke-width="1.5" marker-end="url(#arrowOrange)"/>

            <!-- Redis Pub/Sub -->
            <g transform="translate(560, 140)">
                <rect x="0" y="0" width="120" height="130" fill="#fce7f3" rx="8" stroke="#ec4899" stroke-width="2"/>
                <text x="60" y="25" text-anchor="middle" style="font-size: 12px; font-weight: 600; fill: #9d174d;" font-family="Liberation Sans, Arial, sans-serif">Redis</text>
                <text x="60" y="45" text-anchor="middle" style="font-size: 11px; fill: #be185d;" font-family="Liberation Sans, Arial, sans-serif">Pub/Sub</text>

                <text x="60" y="75" text-anchor="middle" style="font-size: 9px; fill: #78716c;" font-family="Liberation Sans, Arial, sans-serif">Cross-instance</text>
                <text x="60" y="90" text-anchor="middle" style="font-size: 9px; fill: #78716c;" font-family="Liberation Sans, Arial, sans-serif">message</text>
                <text x="60" y="105" text-anchor="middle" style="font-size: 9px; fill: #78716c;" font-family="Liberation Sans, Arial, sans-serif">broadcast</text>
            </g>

            <!-- Arrows from servers to Redis -->
            <line x1="482" y1="135" x2="558" y2="180" stroke="#ec4899" stroke-width="1.5" stroke-dasharray="4,2"/>
            <line x1="482" y1="245" x2="558" y2="220" stroke="#ec4899" stroke-width="1.5" stroke-dasharray="4,2"/>

            <!-- Bidirectional arrow annotation -->
            <text x="520" y="160" text-anchor="middle" style="font-size: 8px; fill: #ec4899;" font-family="Liberation Sans, Arial, sans-serif">pub</text>
            <text x="520" y="250" text-anchor="middle" style="font-size: 8px; fill: #ec4899;" font-family="Liberation Sans, Arial, sans-serif">sub</text>

            <!-- Legend -->
            <g transform="translate(50, 380)">
                <rect x="0" y="0" width="700" height="30" fill="#f8fafc" rx="4"/>
                <circle cx="20" cy="15" r="6" fill="#3b82f6"/>
                <text x="35" y="19" style="font-size: 10px; fill: #64748b;" font-family="Liberation Sans, Arial, sans-serif">WebSocket Connection</text>

                <rect x="180" y="9" width="30" height="12" fill="#fef3c7" rx="2"/>
                <text x="220" y="19" style="font-size: 10px; fill: #64748b;" font-family="Liberation Sans, Arial, sans-serif">Sticky Session Routing</text>

                <line x1="380" y1="15" x2="410" y2="15" stroke="#ec4899" stroke-width="2" stroke-dasharray="4,2"/>
                <text x="420" y="19" style="font-size: 10px; fill: #64748b;" font-family="Liberation Sans, Arial, sans-serif">Pub/Sub Channel</text>

                <rect x="560" y="9" width="30" height="12" fill="#86efac" rx="2"/>
                <text x="600" y="19" style="font-size: 10px; fill: #64748b;" font-family="Liberation Sans, Arial, sans-serif">Active Connection</text>
            </g>

            <!-- Arrow markers -->
            <defs>
                <marker id="arrowOrange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                    <path d="M0,0 L0,6 L9,3 z" fill="#f59e0b"/>
                </marker>
            </defs>
        </svg>
    </div>
</body>
</html>
