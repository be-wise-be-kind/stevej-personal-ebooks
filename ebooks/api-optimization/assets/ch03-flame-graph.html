<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flame Graph Example</title>
    <style>
        body {
            font-family: Liberation Sans, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8fafc;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .diagram-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 24px;
            max-width: 100%;
        }
        svg {
            display: block;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="diagram-container">
        <svg viewBox="0 0 900 525" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <!-- Color palette for flame graph - warm colors indicating "heat" -->
                <linearGradient id="flame1" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" style="stop-color:#ef4444;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#f87171;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="flame2" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" style="stop-color:#f97316;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#fb923c;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="flame3" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" style="stop-color:#eab308;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#facc15;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="flame4" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" style="stop-color:#84cc16;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#a3e635;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="flame5" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" style="stop-color:#22c55e;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#4ade80;stop-opacity:1" />
                </linearGradient>
                <filter id="shadow" x="-2%" y="-2%" width="104%" height="104%">
                    <feDropShadow dx="0" dy="1" stdDeviation="1" flood-opacity="0.1"/>
                </filter>
            </defs>

            <!-- Title -->
            <text x="450" y="35" text-anchor="middle" font-size="22" font-weight="600" fill="#1f2937">CPU Flame Graph - API Request Handler</text>
            <text x="450" y="55" text-anchor="middle" font-size="12" fill="#64748b">Width represents time spent in each function; taller stacks show deeper call chains</text>

            <!-- Flame Graph Stack (bottom-up) -->
            <!-- Level 0: main() - full width -->
            <g transform="translate(50, 305)">
                <rect x="0" y="0" width="800" height="40" rx="3" fill="url(#flame1)" filter="url(#shadow)"/>
                <text x="400" y="26" text-anchor="middle" font-size="13" font-weight="500" fill="white">main() - 100%</text>
            </g>

            <!-- Level 1: http_handler() - 95% width -->
            <g transform="translate(50, 260)">
                <rect x="0" y="0" width="760" height="40" rx="3" fill="url(#flame2)" filter="url(#shadow)"/>
                <text x="380" y="26" text-anchor="middle" font-size="13" font-weight="500" fill="white">http_handler() - 95%</text>
            </g>

            <!-- Level 2: Multiple functions -->
            <!-- process_request() - 70% -->
            <g transform="translate(50, 215)">
                <rect x="0" y="0" width="560" height="40" rx="3" fill="url(#flame3)" filter="url(#shadow)"/>
                <text x="280" y="26" text-anchor="middle" font-size="12" font-weight="500" fill="#1f2937">process_request() - 70%</text>
            </g>
            <!-- send_response() - 20% -->
            <g transform="translate(620, 215)">
                <rect x="0" y="0" width="160" height="40" rx="3" fill="url(#flame4)" filter="url(#shadow)"/>
                <text x="80" y="26" text-anchor="middle" font-size="11" font-weight="500" fill="#1f2937">send_response()</text>
            </g>

            <!-- Level 3: Under process_request() -->
            <!-- database_query() - 40% -->
            <g transform="translate(50, 170)">
                <rect x="0" y="0" width="320" height="40" rx="3" fill="url(#flame2)" filter="url(#shadow)"/>
                <text x="160" y="26" text-anchor="middle" font-size="12" font-weight="500" fill="white">database_query() - 40%</text>
            </g>
            <!-- json_serialize() - 25% -->
            <g transform="translate(380, 170)">
                <rect x="0" y="0" width="200" height="40" rx="3" fill="url(#flame4)" filter="url(#shadow)"/>
                <text x="100" y="26" text-anchor="middle" font-size="11" font-weight="500" fill="#1f2937">json_serialize() - 25%</text>
            </g>
            <!-- validate_input() - 5% -->
            <g transform="translate(590, 170)">
                <rect x="0" y="0" width="40" height="40" rx="3" fill="url(#flame5)" filter="url(#shadow)"/>
                <text x="20" y="26" text-anchor="middle" font-size="8" font-weight="500" fill="#1f2937">5%</text>
            </g>

            <!-- Level 4: Under database_query() -->
            <!-- execute_sql() - 30% -->
            <g transform="translate(50, 125)">
                <rect x="0" y="0" width="240" height="40" rx="3" fill="url(#flame1)" filter="url(#shadow)"/>
                <text x="120" y="26" text-anchor="middle" font-size="12" font-weight="500" fill="white">execute_sql() - 30%</text>
            </g>
            <!-- parse_results() - 8% -->
            <g transform="translate(300, 125)">
                <rect x="0" y="0" width="64" height="40" rx="3" fill="url(#flame4)" filter="url(#shadow)"/>
                <text x="32" y="26" text-anchor="middle" font-size="9" font-weight="500" fill="#1f2937">parse</text>
            </g>

            <!-- Level 5: Under execute_sql() -->
            <!-- network_io() - 22% -->
            <g transform="translate(50, 80)">
                <rect x="0" y="0" width="176" height="40" rx="3" fill="url(#flame2)" filter="url(#shadow)"/>
                <text x="88" y="26" text-anchor="middle" font-size="11" font-weight="500" fill="white">network_io() - 22%</text>
            </g>
            <!-- prepare_statement() - 6% -->
            <g transform="translate(234, 80)">
                <rect x="0" y="0" width="48" height="40" rx="3" fill="url(#flame5)" filter="url(#shadow)"/>
                <text x="24" y="26" text-anchor="middle" font-size="8" font-weight="500" fill="#1f2937">prep</text>
            </g>

            <!-- Annotations / Callouts -->
            <g transform="translate(0, 0)">
                <!-- Hotspot indicator - positioned to left side to avoid title overlap -->
                <line x1="138" y1="75" x2="80" y2="50" stroke="#ef4444" stroke-width="2"/>
                <circle cx="75" cy="45" r="6" fill="#ef4444"/>
                <text x="30" y="60" font-size="11" font-weight="600" fill="#ef4444">HOTSPOT</text>
                <text x="30" y="73" font-size="10" fill="#64748b">22% in I/O wait</text>
            </g>

            <!-- Legend -->
            <g transform="translate(50, 365)">
                <rect x="0" y="0" width="800" height="140" rx="8" fill="#f8fafc" stroke="#e2e8f0" stroke-width="1"/>

                <text x="20" y="25" font-size="14" font-weight="600" fill="#374151">How to Read This Flame Graph</text>

                <g transform="translate(20, 40)">
                    <rect x="0" y="0" width="20" height="14" rx="2" fill="url(#flame1)"/>
                    <text x="28" y="11" font-size="11" fill="#4b5563">Hot path (high CPU time)</text>

                    <rect x="180" y="0" width="20" height="14" rx="2" fill="url(#flame3)"/>
                    <text x="208" y="11" font-size="11" fill="#4b5563">Moderate CPU usage</text>

                    <rect x="370" y="0" width="20" height="14" rx="2" fill="url(#flame5)"/>
                    <text x="398" y="11" font-size="11" fill="#4b5563">Low CPU time</text>
                </g>

                <g transform="translate(20, 70)">
                    <text x="0" y="12" font-size="11" fill="#64748b">- Each box represents a function in the call stack</text>
                    <text x="0" y="28" font-size="11" fill="#64748b">- Width indicates time spent (wider = more CPU time)</text>
                    <text x="400" y="12" font-size="11" fill="#64748b">- Boxes stacked on top are functions called by boxes below</text>
                    <text x="400" y="28" font-size="11" fill="#64748b">- Look for wide boxes to identify optimization targets</text>
                </g>

                <g transform="translate(20, 118)">
                    <text x="0" y="0" font-size="10" fill="#94a3b8">Insight: database_query() and network_io() consume 62% of CPU - optimize DB queries and connection pooling</text>
                </g>
            </g>
        </svg>
    </div>
</body>
</html>
