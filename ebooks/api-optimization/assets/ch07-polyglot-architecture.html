<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polyglot Persistence Architecture</title>
    <style>
        body {
            font-family: Liberation Sans, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8fafc;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .diagram-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 24px;
            max-width: 100%;
        }
        svg {
            display: block;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="diagram-container">
        <svg viewBox="0 0 850 480" xmlns="http://www.w3.org/2000/svg">
            <!-- Background -->
            <rect width="850" height="480" fill="white"/>

            <!-- Title -->
            <text x="425" y="30" text-anchor="middle" style="font-size: 18px; font-weight: 600; fill: #1e293b;" font-family="Liberation Sans, Arial, sans-serif">Polyglot Persistence Architecture</text>

            <!-- Users -->
            <text x="100" y="65" text-anchor="middle" style="font-size: 11px; fill: #64748b; font-weight: 500;" font-family="Liberation Sans, Arial, sans-serif">Users</text>
            <rect x="60" y="75" width="80" height="30" fill="#e0f2fe" rx="4" stroke="#0284c7" stroke-width="1"/>
            <rect x="60" y="110" width="80" height="30" fill="#e0f2fe" rx="4" stroke="#0284c7" stroke-width="1"/>
            <rect x="60" y="145" width="80" height="30" fill="#e0f2fe" rx="4" stroke="#0284c7" stroke-width="1"/>

            <!-- API Layer -->
            <rect x="200" y="75" width="120" height="110" fill="#3b82f6" rx="8"/>
            <text x="260" y="105" text-anchor="middle" style="font-size: 12px; fill: white; font-weight: 600;" font-family="Liberation Sans, Arial, sans-serif">API Layer</text>
            <text x="260" y="125" text-anchor="middle" style="font-size: 10px; fill: #bfdbfe;" font-family="Liberation Sans, Arial, sans-serif">Routes requests to</text>
            <text x="260" y="140" text-anchor="middle" style="font-size: 10px; fill: #bfdbfe;" font-family="Liberation Sans, Arial, sans-serif">appropriate store</text>
            <text x="260" y="160" text-anchor="middle" style="font-size: 10px; fill: #bfdbfe;" font-family="Liberation Sans, Arial, sans-serif">by operation type</text>

            <!-- Arrows from users to API -->
            <line x1="145" y1="90" x2="195" y2="110" stroke="#0284c7" stroke-width="1.5" marker-end="url(#arrowBlueLight)"/>
            <line x1="145" y1="125" x2="195" y2="130" stroke="#0284c7" stroke-width="1.5" marker-end="url(#arrowBlueLight)"/>
            <line x1="145" y1="160" x2="195" y2="150" stroke="#0284c7" stroke-width="1.5" marker-end="url(#arrowBlueLight)"/>

            <!-- Data stores -->
            <!-- PostgreSQL (Source of Truth) -->
            <rect x="380" y="50" width="180" height="90" fill="#22c55e" rx="8"/>
            <text x="470" y="75" text-anchor="middle" style="font-size: 12px; fill: white; font-weight: 600;" font-family="Liberation Sans, Arial, sans-serif">PostgreSQL</text>
            <text x="470" y="95" text-anchor="middle" style="font-size: 10px; fill: #bbf7d0;" font-family="Liberation Sans, Arial, sans-serif">Orders, Users, Inventory</text>
            <text x="470" y="115" text-anchor="middle" style="font-size: 9px; fill: #dcfce7;" font-family="Liberation Sans, Arial, sans-serif">ACID • Source of Truth</text>
            <rect x="520" y="125" width="35" height="12" fill="#166534" rx="2"/>
            <text x="537" y="134" text-anchor="middle" style="font-size: 7px; fill: white; font-weight: 600;" font-family="Liberation Sans, Arial, sans-serif">PRIMARY</text>

            <!-- Redis -->
            <rect x="380" y="160" width="180" height="70" fill="#8b5cf6" rx="8"/>
            <text x="470" y="185" text-anchor="middle" style="font-size: 12px; fill: white; font-weight: 600;" font-family="Liberation Sans, Arial, sans-serif">Redis</text>
            <text x="470" y="205" text-anchor="middle" style="font-size: 10px; fill: #ddd6fe;" font-family="Liberation Sans, Arial, sans-serif">Sessions, Cart, Cache</text>
            <text x="470" y="220" text-anchor="middle" style="font-size: 9px; fill: #ede9fe;" font-family="Liberation Sans, Arial, sans-serif">&lt;1ms latency</text>

            <!-- Elasticsearch -->
            <rect x="380" y="250" width="180" height="70" fill="#ec4899" rx="8"/>
            <text x="470" y="275" text-anchor="middle" style="font-size: 12px; fill: white; font-weight: 600;" font-family="Liberation Sans, Arial, sans-serif">Elasticsearch</text>
            <text x="470" y="295" text-anchor="middle" style="font-size: 10px; fill: #fbcfe8;" font-family="Liberation Sans, Arial, sans-serif">Product Search</text>
            <text x="470" y="310" text-anchor="middle" style="font-size: 9px; fill: #fce7f3;" font-family="Liberation Sans, Arial, sans-serif">Full-text, Facets</text>

            <!-- Vector DB -->
            <rect x="380" y="340" width="180" height="70" fill="#06b6d4" rx="8"/>
            <text x="470" y="365" text-anchor="middle" style="font-size: 12px; fill: white; font-weight: 600;" font-family="Liberation Sans, Arial, sans-serif">Vector DB</text>
            <text x="470" y="385" text-anchor="middle" style="font-size: 10px; fill: #a5f3fc;" font-family="Liberation Sans, Arial, sans-serif">Recommendations</text>
            <text x="470" y="400" text-anchor="middle" style="font-size: 9px; fill: #cffafe;" font-family="Liberation Sans, Arial, sans-serif">Similarity Search</text>

            <!-- Arrows from API to data stores -->
            <line x1="320" y1="100" x2="375" y2="85" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrowBlue)"/>
            <line x1="320" y1="120" x2="375" y2="190" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrowBlue)"/>
            <line x1="320" y1="140" x2="375" y2="280" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrowBlue)"/>
            <line x1="320" y1="160" x2="375" y2="370" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrowBlue)"/>

            <!-- Data sync section -->
            <rect x="600" y="50" width="200" height="360" fill="#f8fafc" rx="8" stroke="#e2e8f0" stroke-width="2"/>
            <text x="700" y="75" text-anchor="middle" style="font-size: 11px; fill: #374151; font-weight: 600;" font-family="Liberation Sans, Arial, sans-serif">Data Synchronization</text>

            <!-- Sync arrows from PostgreSQL -->
            <line x1="560" y1="95" x2="595" y2="95" stroke="#22c55e" stroke-width="2"/>

            <!-- CDC box -->
            <rect x="620" y="100" width="160" height="50" fill="#dcfce7" rx="4" stroke="#22c55e" stroke-width="1"/>
            <text x="700" y="120" text-anchor="middle" style="font-size: 10px; fill: #166534; font-weight: 500;" font-family="Liberation Sans, Arial, sans-serif">Change Data Capture</text>
            <text x="700" y="135" text-anchor="middle" style="font-size: 9px; fill: #15803d;" font-family="Liberation Sans, Arial, sans-serif">Debezium, pg_logical</text>

            <!-- Sync to Redis -->
            <line x1="700" y1="150" x2="700" y2="170" stroke="#64748b" stroke-width="1.5"/>
            <rect x="620" y="170" width="160" height="40" fill="#f3e8ff" rx="4" stroke="#a855f7" stroke-width="1"/>
            <text x="700" y="190" text-anchor="middle" style="font-size: 9px; fill: #7c3aed;" font-family="Liberation Sans, Arial, sans-serif">Invalidate cache on change</text>
            <text x="700" y="203" text-anchor="middle" style="font-size: 8px; fill: #9333ea;" font-family="Liberation Sans, Arial, sans-serif">→ Redis</text>

            <!-- Sync to Elasticsearch -->
            <line x1="700" y1="210" x2="700" y2="230" stroke="#64748b" stroke-width="1.5"/>
            <rect x="620" y="230" width="160" height="40" fill="#fce7f3" rx="4" stroke="#ec4899" stroke-width="1"/>
            <text x="700" y="250" text-anchor="middle" style="font-size: 9px; fill: #be185d;" font-family="Liberation Sans, Arial, sans-serif">Reindex on product update</text>
            <text x="700" y="263" text-anchor="middle" style="font-size: 8px; fill: #db2777;" font-family="Liberation Sans, Arial, sans-serif">→ Elasticsearch</text>

            <!-- Sync to Vector DB -->
            <line x1="700" y1="270" x2="700" y2="290" stroke="#64748b" stroke-width="1.5"/>
            <rect x="620" y="290" width="160" height="40" fill="#cffafe" rx="4" stroke="#06b6d4" stroke-width="1"/>
            <text x="700" y="310" text-anchor="middle" style="font-size: 9px; fill: #0891b2;" font-family="Liberation Sans, Arial, sans-serif">Re-embed on content change</text>
            <text x="700" y="323" text-anchor="middle" style="font-size: 8px; fill: #0e7490;" font-family="Liberation Sans, Arial, sans-serif">→ Vector DB</text>

            <!-- Consistency note -->
            <rect x="620" y="345" width="160" height="55" fill="#fef3c7" rx="4" stroke="#f59e0b" stroke-width="1"/>
            <text x="700" y="363" text-anchor="middle" style="font-size: 9px; fill: #92400e; font-weight: 500;" font-family="Liberation Sans, Arial, sans-serif">Eventual Consistency</text>
            <text x="700" y="378" text-anchor="middle" style="font-size: 8px; fill: #a16207;" font-family="Liberation Sans, Arial, sans-serif">Secondary stores may lag</text>
            <text x="700" y="391" text-anchor="middle" style="font-size: 8px; fill: #a16207;" font-family="Liberation Sans, Arial, sans-serif">~100ms - few seconds</text>

            <!-- Bottom notes -->
            <rect x="50" y="430" width="750" height="40" fill="#f1f5f9" rx="6"/>
            <text x="425" y="450" text-anchor="middle" style="font-size: 10px; fill: #374151; font-weight: 500;" font-family="Liberation Sans, Arial, sans-serif">Trade-off: Operational complexity (4 databases) for optimal performance per access pattern</text>
            <text x="425" y="463" text-anchor="middle" style="font-size: 10px; fill: #64748b;" font-family="Liberation Sans, Arial, sans-serif">PostgreSQL is always source of truth • Secondary stores are derived views • Design for sync failures</text>

            <!-- Arrow markers -->
            <defs>
                <marker id="arrowBlue" markerWidth="8" markerHeight="8" refX="7" refY="3" orient="auto" markerUnits="strokeWidth">
                    <path d="M0,0 L0,6 L9,3 z" fill="#3b82f6"/>
                </marker>
                <marker id="arrowBlueLight" markerWidth="8" markerHeight="8" refX="7" refY="3" orient="auto" markerUnits="strokeWidth">
                    <path d="M0,0 L0,6 L9,3 z" fill="#0284c7"/>
                </marker>
            </defs>
        </svg>
    </div>
</body>
</html>
