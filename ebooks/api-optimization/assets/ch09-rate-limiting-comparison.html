<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fixed Window vs Sliding Window Rate Limiting</title>
    <style>
        body {
            font-family: Liberation Sans, Arial, sans-serif;
            background: #f8fafc;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .diagram-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 24px;
            max-width: 100%;
        }
        svg {
            display: block;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="diagram-container">
        
        <svg viewBox="0 0 900 580" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <linearGradient id="requestGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#2563eb;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="warningGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#f97316;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#ea580c;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="dangerGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#ef4444;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#dc2626;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="successGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#22c55e;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#16a34a;stop-opacity:1" />
                </linearGradient>
                <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
                    <feDropShadow dx="0" dy="2" stdDeviation="2" flood-opacity="0.1"/>
                </filter>
                <pattern id="grid" width="40" height="20" patternUnits="userSpaceOnUse">
                    <path d="M 40 0 L 0 0 0 20" fill="none" stroke="#e2e8f0" stroke-width="1"/>
                </pattern>
            </defs>

            <!-- Section 1: Fixed Window Problem -->
            <g transform="translate(50, 30)">
                <text x="0" y="0" fill="#1e293b" font-size="14" font-weight="600" font-family="Liberation Sans, Arial, sans-serif">Fixed Window Rate Limiting</text>
                <text x="0" y="22" fill="#64748b" font-size="11" font-family="Liberation Sans, Arial, sans-serif">Limit: 100 requests per minute</text>

                <!-- Timeline background -->
                <rect x="0" y="45" width="750" height="145" fill="#f8fafc" rx="4"/>
                <rect x="0" y="45" width="750" height="145" fill="url(#grid)"/>

                <!-- Window boundaries -->
                <line x1="0" y1="45" x2="0" y2="190" stroke="#94a3b8" stroke-width="2" stroke-dasharray="4,4"/>
                <line x1="375" y1="45" x2="375" y2="190" stroke="#94a3b8" stroke-width="2" stroke-dasharray="4,4"/>
                <line x1="750" y1="45" x2="750" y2="190" stroke="#94a3b8" stroke-width="2" stroke-dasharray="4,4"/>

                <!-- Window labels -->
                <text x="187" y="210" text-anchor="middle" fill="#64748b" font-size="10" font-family="Liberation Sans, Arial, sans-serif">Window 1 (00:00 - 00:59)</text>
                <text x="562" y="210" text-anchor="middle" fill="#64748b" font-size="10" font-family="Liberation Sans, Arial, sans-serif">Window 2 (01:00 - 01:59)</text>

                <!-- Request bars - clustered at window boundary -->
                <!-- Window 1: 80 requests at end (around :50-:59) -->
                <g transform="translate(280, 160)">
                    <rect x="0" y="-90" width="40" height="90" rx="2" fill="url(#requestGrad)" filter="url(#shadow)"/>
                    <text x="20" y="-98" text-anchor="middle" fill="#3b82f6" font-size="9" font-weight="600" font-family="Liberation Sans, Arial, sans-serif">80 req</text>
                    <text x="20" y="18" text-anchor="middle" fill="#64748b" font-size="10" font-family="Liberation Sans, Arial, sans-serif">:50-:59</text>
                </g>

                <!-- Window 2: 80 requests at start (around :00-:09) -->
                <g transform="translate(400, 160)">
                    <rect x="0" y="-90" width="40" height="90" rx="2" fill="url(#requestGrad)" filter="url(#shadow)"/>
                    <text x="20" y="-98" text-anchor="middle" fill="#3b82f6" font-size="9" font-weight="600" font-family="Liberation Sans, Arial, sans-serif">80 req</text>
                    <text x="20" y="18" text-anchor="middle" fill="#64748b" font-size="10" font-family="Liberation Sans, Arial, sans-serif">:00-:09</text>
                </g>

                <!-- Bracket showing spike period -->
                <path d="M 300 115 L 300 120 L 440 120 L 440 115" stroke="#ef4444" stroke-width="2" fill="none"/>
                <line x1="370" y1="120" x2="370" y2="108" stroke="#ef4444" stroke-width="2"/>

                <!-- Problem annotation (positioned to the right) -->
                <g transform="translate(490, 55)">
                    <rect x="0" y="0" width="160" height="60" rx="4" fill="#fef2f2" stroke="#fca5a5" stroke-width="1"/>
                    <text x="80" y="24" text-anchor="middle" fill="#991b1b" font-size="10" font-weight="600" font-family="Liberation Sans, Arial, sans-serif">Boundary Spike!</text>
                    <text x="80" y="44" text-anchor="middle" fill="#b91c1c" font-size="9" font-family="Liberation Sans, Arial, sans-serif">160 req in 20 seconds</text>
                </g>
                <!-- Arrow from annotation to bracket -->
                <path d="M 490 90 L 445 115" stroke="#ef4444" stroke-width="1.5" fill="none" marker-end="url(#arrowRed)"/>

                <defs>
                    <marker id="arrowRed" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
                        <polygon points="0 0, 8 3, 0 6" fill="#ef4444"/>
                    </marker>
                </defs>
            </g>

            <!-- Section 2: Sliding Window Solution -->
            <g transform="translate(50, 290)">
                <text x="0" y="0" fill="#1e293b" font-size="14" font-weight="600" font-family="Liberation Sans, Arial, sans-serif">Sliding Window Rate Limiting</text>
                <text x="0" y="22" fill="#64748b" font-size="11" font-family="Liberation Sans, Arial, sans-serif">Limit: 100 requests per rolling minute</text>

                <!-- Timeline background -->
                <rect x="0" y="45" width="750" height="145" fill="#f8fafc" rx="4"/>
                <rect x="0" y="45" width="750" height="145" fill="url(#grid)"/>

                <!-- Sliding window visualization -->
                <rect x="280" y="50" width="160" height="130" rx="4" fill="#dcfce7" opacity="0.5" stroke="#22c55e" stroke-width="2" stroke-dasharray="6,3"/>
                <text x="360" y="70" text-anchor="middle" fill="#15803d" font-size="9" font-weight="600" font-family="Liberation Sans, Arial, sans-serif">Sliding Window</text>

                <!-- Request bars - more evenly distributed -->
                <g transform="translate(120, 155)">
                    <rect x="0" y="-50" width="35" height="50" rx="2" fill="url(#requestGrad)" filter="url(#shadow)"/>
                    <text x="17" y="-58" text-anchor="middle" fill="#3b82f6" font-size="9" font-family="Liberation Sans, Arial, sans-serif">40</text>
                </g>
                <g transform="translate(200, 155)">
                    <rect x="0" y="-38" width="35" height="38" rx="2" fill="url(#requestGrad)" filter="url(#shadow)"/>
                    <text x="17" y="-46" text-anchor="middle" fill="#3b82f6" font-size="9" font-family="Liberation Sans, Arial, sans-serif">30</text>
                </g>
                <g transform="translate(295, 155)">
                    <rect x="0" y="-38" width="35" height="38" rx="2" fill="url(#requestGrad)" filter="url(#shadow)"/>
                    <text x="17" y="-46" text-anchor="middle" fill="#3b82f6" font-size="9" font-family="Liberation Sans, Arial, sans-serif">30</text>
                </g>
                <g transform="translate(390, 155)">
                    <rect x="0" y="-44" width="35" height="44" rx="2" fill="url(#requestGrad)" filter="url(#shadow)"/>
                    <text x="17" y="-52" text-anchor="middle" fill="#3b82f6" font-size="9" font-family="Liberation Sans, Arial, sans-serif">35</text>
                </g>
                <g transform="translate(475, 155)">
                    <rect x="0" y="-38" width="35" height="38" rx="2" fill="url(#requestGrad)" filter="url(#shadow)"/>
                    <text x="17" y="-46" text-anchor="middle" fill="#3b82f6" font-size="9" font-family="Liberation Sans, Arial, sans-serif">30</text>
                </g>
                <g transform="translate(560, 155)">
                    <rect x="0" y="-32" width="35" height="32" rx="2" fill="url(#requestGrad)" filter="url(#shadow)"/>
                    <text x="17" y="-40" text-anchor="middle" fill="#3b82f6" font-size="9" font-family="Liberation Sans, Arial, sans-serif">25</text>
                </g>

                <!-- Success annotation -->
                <g transform="translate(595, 55)">
                    <rect x="0" y="0" width="150" height="80" rx="4" fill="#f0fdf4" stroke="#86efac" stroke-width="1"/>
                    <text x="75" y="22" text-anchor="middle" fill="#166534" font-size="10" font-weight="600" font-family="Liberation Sans, Arial, sans-serif">Smooth Enforcement</text>
                    <text x="75" y="44" text-anchor="middle" fill="#15803d" font-size="9" font-family="Liberation Sans, Arial, sans-serif">No boundary spikes</text>
                    <text x="75" y="64" text-anchor="middle" fill="#15803d" font-size="9" font-family="Liberation Sans, Arial, sans-serif">Weighted calculation</text>
                </g>

                <!-- Time axis -->
                <line x1="0" y1="185" x2="750" y2="185" stroke="#94a3b8" stroke-width="1"/>
                <text x="375" y="205" text-anchor="middle" fill="#64748b" font-size="10" font-family="Liberation Sans, Arial, sans-serif">Time</text>
            </g>

            <!-- Formula box -->
            <g transform="translate(50, 510)">
                <rect x="0" y="0" width="800" height="60" rx="6" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
                <text x="22" y="26" fill="#475569" font-size="11" font-weight="600" font-family="Liberation Sans, Arial, sans-serif">Sliding Window Formula:</text>
                <text x="22" y="48" fill="#64748b" font-size="11" font-family="monospace">weighted_count = current_window_count + (previous_window_count x overlap_percentage)</text>
            </g>

            <!-- Legend -->
            <g transform="translate(580, 510)">
                <rect x="-10" y="0" width="260" height="40" rx="4" fill="#f8fafc" stroke="#e2e8f0" stroke-width="1"/>
                <rect x="8" y="12" width="16" height="16" rx="2" fill="url(#requestGrad)"/>
                <text x="32" y="25" fill="#64748b" font-size="10" font-family="Liberation Sans, Arial, sans-serif">Request count</text>
                <rect x="128" y="12" width="16" height="16" rx="2" fill="#dcfce7" stroke="#22c55e" stroke-width="1" stroke-dasharray="2,1"/>
                <text x="152" y="25" fill="#64748b" font-size="10" font-family="Liberation Sans, Arial, sans-serif">Sliding window</text>
            </g>
        </svg>
    </div>
</body>
</html>
