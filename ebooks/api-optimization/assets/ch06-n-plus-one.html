<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N+1 Query Problem Visualization</title>
    <style>
        body {
            font-family: Liberation Sans, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8fafc;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .diagram-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 24px;
            max-width: 100%;
        }
        svg {
            display: block;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="diagram-container">
        
        <svg viewBox="0 0 1000 625" xmlns="http://www.w3.org/2000/svg">
            <!-- Title -->
            <text x="500.0" y="35" text-anchor="middle" font-family="Liberation Sans, Arial, sans-serif" font-size="20" font-weight="600" fill="#1e293b">N+1 Query Problem vs. JOIN Solution</text>

            <defs>
                <!-- Gradients -->
                <linearGradient id="appGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#7c3aed;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="dbGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#2563eb;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="badGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#ef4444;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#dc2626;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="goodGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#10b981;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
                </linearGradient>
                <!-- Arrow markers -->
                <marker id="arrowRed" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#ef4444"/>
                </marker>
                <marker id="arrowGreen" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#10b981"/>
                </marker>
                <marker id="arrowBlue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6"/>
                </marker>
                <!-- Drop shadow -->
                <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
                    <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.15"/>
                </filter>
            </defs>

            <!-- Divider line -->
            <line x1="500" y1="95" x2="500" y2="575" stroke="#e2e8f0" stroke-width="2" stroke-dasharray="8,4"/>

            <!-- LEFT SIDE: N+1 Pattern (Bad) -->
            <text x="250" y="85" text-anchor="middle" fill="#dc2626" font-size="18" font-weight="700">N+1 Pattern (Inefficient)</text>

            <!-- Application Box -->
            <g>
                <rect x="30" y="115" width="120" height="50" rx="8" fill="url(#appGradient)" filter="url(#shadow)"/>
                <text x="90" y="145" text-anchor="middle" fill="white" font-size="13" font-weight="600">Application</text>
            </g>

            <!-- Database Box -->
            <g>
                <rect x="320" y="115" width="140" height="50" rx="8" fill="url(#dbGradient)" filter="url(#shadow)"/>
                <text x="390" y="145" text-anchor="middle" fill="white" font-size="13" font-weight="600">Database</text>
            </g>

            <!-- Query 1: Get all posts -->
            <line x1="150" y1="140" x2="310" y2="140" stroke="#ef4444" stroke-width="2" marker-end="url(#arrowRed)"/>
            <text x="230" y="133" text-anchor="middle" fill="#64748b" font-size="10">SELECT * FROM posts</text>

            <!-- Response 1: N posts -->
            <line x1="310" y1="190" x2="150" y2="190" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrowBlue)"/>
            <text x="230" y="205" text-anchor="middle" fill="#64748b" font-size="10">Returns N posts</text>

            <!-- Query 2-N+1: Individual author queries (shown as multiple arrows) -->
            <g>
                <!-- Query 2 -->
                <line x1="150" y1="240" x2="310" y2="240" stroke="#ef4444" stroke-width="2" marker-end="url(#arrowRed)"/>
                <text x="230" y="233" text-anchor="middle" fill="#64748b" font-size="9">SELECT * FROM users WHERE id=1</text>
                <line x1="310" y1="260" x2="150" y2="260" stroke="#3b82f6" stroke-width="1.5" stroke-dasharray="4,2" marker-end="url(#arrowBlue)"/>

                <!-- Query 3 -->
                <line x1="150" y1="290" x2="310" y2="290" stroke="#ef4444" stroke-width="2" marker-end="url(#arrowRed)"/>
                <text x="230" y="283" text-anchor="middle" fill="#64748b" font-size="9">SELECT * FROM users WHERE id=2</text>
                <line x1="310" y1="310" x2="150" y2="310" stroke="#3b82f6" stroke-width="1.5" stroke-dasharray="4,2" marker-end="url(#arrowBlue)"/>

                <!-- Query 4 -->
                <line x1="150" y1="340" x2="310" y2="340" stroke="#ef4444" stroke-width="2" marker-end="url(#arrowRed)"/>
                <text x="230" y="333" text-anchor="middle" fill="#64748b" font-size="9">SELECT * FROM users WHERE id=3</text>
                <line x1="310" y1="360" x2="150" y2="360" stroke="#3b82f6" stroke-width="1.5" stroke-dasharray="4,2" marker-end="url(#arrowBlue)"/>

                <!-- Ellipsis -->
                <text x="230" y="390" text-anchor="middle" fill="#64748b" font-size="16" font-weight="bold">...</text>

                <!-- Query N+1 -->
                <line x1="150" y1="420" x2="310" y2="420" stroke="#ef4444" stroke-width="2" marker-end="url(#arrowRed)"/>
                <text x="230" y="413" text-anchor="middle" fill="#64748b" font-size="9">SELECT * FROM users WHERE id=N</text>
                <line x1="310" y1="440" x2="150" y2="440" stroke="#3b82f6" stroke-width="1.5" stroke-dasharray="4,2" marker-end="url(#arrowBlue)"/>
            </g>

            <!-- N+1 Stats Box -->
            <g>
                <rect x="60" y="475" width="360" height="90" rx="8" fill="#fef2f2" stroke="#fecaca" stroke-width="2" filter="url(#shadow)"/>
                <text x="240" y="505" text-anchor="middle" fill="#dc2626" font-size="14" font-weight="700">Performance Impact</text>
                <text x="240" y="530" text-anchor="middle" fill="#7f1d1d" font-size="12">Total queries: N + 1 = 101 (for 100 posts)</text>
                <text x="240" y="550" text-anchor="middle" fill="#7f1d1d" font-size="12">Total time: 101 x 2-5ms = 200-500ms</text>
            </g>

            <!-- RIGHT SIDE: JOIN Pattern (Good) -->
            <text x="750" y="85" text-anchor="middle" fill="#059669" font-size="18" font-weight="700">JOIN Pattern (Efficient)</text>

            <!-- Application Box -->
            <g>
                <rect x="540" y="115" width="120" height="50" rx="8" fill="url(#appGradient)" filter="url(#shadow)"/>
                <text x="600" y="145" text-anchor="middle" fill="white" font-size="13" font-weight="600">Application</text>
            </g>

            <!-- Database Box -->
            <g>
                <rect x="820" y="115" width="140" height="50" rx="8" fill="url(#dbGradient)" filter="url(#shadow)"/>
                <text x="890" y="145" text-anchor="middle" fill="white" font-size="13" font-weight="600">Database</text>
            </g>

            <!-- Single JOIN query -->
            <line x1="660" y1="155" x2="810" y2="155" stroke="#10b981" stroke-width="3" marker-end="url(#arrowGreen)"/>
            <text x="735" y="180" text-anchor="middle" fill="#64748b" font-size="9">SELECT p.*, u.name FROM posts p</text>
            <text x="735" y="192" text-anchor="middle" fill="#64748b" font-size="9">JOIN users u ON p.author_id = u.id</text>

            <!-- Single response with all data -->
            <g>
                <line x1="810" y1="245" x2="660" y2="245" stroke="#3b82f6" stroke-width="3" marker-end="url(#arrowBlue)"/>
                <text x="735" y="215" text-anchor="middle" fill="#64748b" font-size="10">Returns all posts</text>
                <text x="735" y="230" text-anchor="middle" fill="#64748b" font-size="10">with author data</text>
            </g>

            <!-- Visual representation of joined data -->
            <g>
                <rect x="560" y="285" width="180" height="140" rx="8" fill="#f0fdf4" stroke="#86efac" stroke-width="2" filter="url(#shadow)"/>
                <text x="650" y="310" text-anchor="middle" fill="#166534" font-size="12" font-weight="600">Result Set</text>

                <text x="580" y="335" fill="#166534" font-size="10">post_1, author_name_1</text>
                <text x="580" y="353" fill="#166534" font-size="10">post_2, author_name_2</text>
                <text x="580" y="371" fill="#166534" font-size="10">post_3, author_name_3</text>
                <text x="650" y="395" text-anchor="middle" fill="#166534" font-size="12">...</text>
                <text x="580" y="417" fill="#166534" font-size="10">post_N, author_name_N</text>
            </g>

            <!-- JOIN Stats Box -->
            <g>
                <rect x="560" y="475" width="360" height="90" rx="8" fill="#f0fdf4" stroke="#86efac" stroke-width="2" filter="url(#shadow)"/>
                <text x="740" y="505" text-anchor="middle" fill="#059669" font-size="14" font-weight="700">Performance Impact</text>
                <text x="740" y="530" text-anchor="middle" fill="#166534" font-size="12">Total queries: 1 (single JOIN query)</text>
                <text x="740" y="550" text-anchor="middle" fill="#166534" font-size="12">Total time: 1 x 5-15ms = 5-15ms</text>
            </g>

            <!-- Improvement callout -->
            <g>
                <rect x="380" y="585" width="240" height="35" rx="17" fill="url(#goodGradient)" filter="url(#shadow)"/>
                <text x="500" y="608" text-anchor="middle" fill="white" font-size="13" font-weight="700">20-100x Performance Improvement</text>
            </g>
        </svg>
    </div>
</body>
</html>
