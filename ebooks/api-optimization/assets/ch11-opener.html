<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 11: The Authentication Tax</title>
    <style>
        body {
            font-family: Liberation Sans, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8fafc;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .diagram-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 24px;
            max-width: 100%;
        }
        svg {
            display: block;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="diagram-container">
        <svg viewBox="0 0 800 440" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <!-- Request gradient -->
                <linearGradient id="requestGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#2563eb;stop-opacity:1" />
                </linearGradient>

                <!-- Auth overhead gradient (orange/amber) -->
                <linearGradient id="authGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#f97316;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#ea580c;stop-opacity:1" />
                </linearGradient>

                <!-- Total cost gradient (red) -->
                <linearGradient id="totalGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#ef4444;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#dc2626;stop-opacity:1" />
                </linearGradient>

                <!-- Business logic gradient (green) -->
                <linearGradient id="bizGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#22c55e;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#16a34a;stop-opacity:1" />
                </linearGradient>

                <!-- Drop shadow filter -->
                <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
                    <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.15"/>
                </filter>

                <!-- Glow for emphasis -->
                <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
                    <feGaussianBlur stdDeviation="3" result="blur"/>
                    <feMerge>
                        <feMergeNode in="blur"/>
                        <feMergeNode in="SourceGraphic"/>
                    </feMerge>
                </filter>
            </defs>

            <!-- Background -->
            <rect width="800" height="420" fill="#ffffff" rx="8"/>

            <!-- Title -->
            <text x="400" y="35" text-anchor="middle" fill="#1e293b" font-size="20" font-weight="600" font-family="Liberation Sans, Arial, sans-serif">
                The Authentication Tax
            </text>
            <text x="400" y="55" text-anchor="middle" fill="#64748b" font-size="12" font-family="Liberation Sans, Arial, sans-serif">
                Every protected request pays the cost of validation
            </text>

            <!-- Left side: Single Request Timeline -->
            <g transform="translate(40, 90)">
                <text x="100" y="0" text-anchor="middle" fill="#475569" font-size="13" font-weight="600" font-family="Liberation Sans, Arial, sans-serif">
                    Single Request
                </text>

                <!-- Timeline bar -->
                <rect x="0" y="20" width="200" height="40" rx="6" fill="#e2e8f0" filter="url(#shadow)"/>

                <!-- Auth portion (small) -->
                <rect x="0" y="20" width="20" height="40" rx="6" fill="url(#authGradient)"/>
                <rect x="20" y="20" width="0" height="40" fill="url(#authGradient)"/>

                <!-- Business logic portion -->
                <rect x="20" y="20" width="180" height="40" rx="0 6 6 0" fill="url(#bizGradient)"/>

                <!-- Labels -->
                <text x="10" y="85" text-anchor="middle" fill="#ea580c" font-size="10" font-weight="600" font-family="Liberation Sans, Arial, sans-serif">
                    1ms
                </text>
                <text x="10" y="98" text-anchor="middle" fill="#64748b" font-size="10" font-family="Liberation Sans, Arial, sans-serif">
                    auth
                </text>
                <text x="110" y="85" text-anchor="middle" fill="#16a34a" font-size="10" font-weight="600" font-family="Liberation Sans, Arial, sans-serif">
                    50ms
                </text>
                <text x="110" y="98" text-anchor="middle" fill="#64748b" font-size="10" font-family="Liberation Sans, Arial, sans-serif">
                    business logic
                </text>

                <!-- "Seems harmless" annotation -->
                <text x="100" y="130" text-anchor="middle" fill="#94a3b8" font-size="11" font-style="italic" font-family="Liberation Sans, Arial, sans-serif">
                    "Just 1ms overhead..."
                </text>
            </g>

            <!-- Center: Multiplication symbol -->
            <g transform="translate(280, 140)">
                <circle cx="30" cy="30" r="28" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="2"/>
                <text x="30" y="40" text-anchor="middle" fill="#475569" font-size="28" font-weight="700" font-family="Liberation Sans, Arial, sans-serif">
                    ×
                </text>
            </g>

            <!-- Center: Request volume -->
            <g transform="translate(350, 90)">
                <text x="50" y="0" text-anchor="middle" fill="#475569" font-size="13" font-weight="600" font-family="Liberation Sans, Arial, sans-serif">
                    Daily Volume
                </text>

                <!-- Stacked request indicators -->
                <g transform="translate(0, 20)">
                    <!-- Request stream visualization -->
                    <rect x="0" y="0" width="100" height="8" rx="2" fill="url(#requestGradient)" opacity="0.3"/>
                    <rect x="0" y="12" width="100" height="8" rx="2" fill="url(#requestGradient)" opacity="0.4"/>
                    <rect x="0" y="24" width="100" height="8" rx="2" fill="url(#requestGradient)" opacity="0.5"/>
                    <rect x="0" y="36" width="100" height="8" rx="2" fill="url(#requestGradient)" opacity="0.6"/>
                    <rect x="0" y="48" width="100" height="8" rx="2" fill="url(#requestGradient)" opacity="0.7"/>
                    <rect x="0" y="60" width="100" height="8" rx="2" fill="url(#requestGradient)" opacity="0.8"/>
                    <rect x="0" y="72" width="100" height="8" rx="2" fill="url(#requestGradient)" opacity="0.9"/>
                    <rect x="0" y="84" width="100" height="8" rx="2" fill="url(#requestGradient)" opacity="1.0"/>
                </g>

                <!-- Volume number -->
                <text x="50" y="130" text-anchor="middle" fill="#2563eb" font-size="16" font-weight="700" font-family="'SF Mono', 'Monaco', 'Consolas', monospace">
                    10M
                </text>
                <text x="50" y="145" text-anchor="middle" fill="#64748b" font-size="10" font-family="Liberation Sans, Arial, sans-serif">
                    requests/day
                </text>
            </g>

            <!-- Equals sign -->
            <g transform="translate(470, 140)">
                <circle cx="30" cy="30" r="28" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="2"/>
                <text x="30" y="40" text-anchor="middle" fill="#475569" font-size="28" font-weight="700" font-family="Liberation Sans, Arial, sans-serif">
                    =
                </text>
            </g>

            <!-- Right side: Total auth overhead -->
            <g transform="translate(540, 90)">
                <text x="110" y="0" text-anchor="middle" fill="#475569" font-size="13" font-weight="600" font-family="Liberation Sans, Arial, sans-serif">
                    Total Auth Overhead
                </text>

                <!-- Large overhead visualization -->
                <rect x="0" y="20" width="220" height="100" rx="8" fill="url(#totalGradient)" filter="url(#shadow)" opacity="0.15"/>
                <rect x="0" y="20" width="220" height="100" rx="8" fill="none" stroke="url(#totalGradient)" stroke-width="3"/>

                <!-- Clock icon -->
                <g transform="translate(30, 45)">
                    <circle cx="25" cy="25" r="22" fill="none" stroke="#ef4444" stroke-width="3"/>
                    <line x1="25" y1="25" x2="25" y2="12" stroke="#ef4444" stroke-width="3" stroke-linecap="round"/>
                    <line x1="25" y1="25" x2="35" y2="30" stroke="#ef4444" stroke-width="3" stroke-linecap="round"/>
                </g>

                <!-- Time value -->
                <text x="145" y="60" text-anchor="middle" fill="#dc2626" font-size="28" font-weight="700" font-family="'SF Mono', 'Monaco', 'Consolas', monospace">
                    2.8 hrs
                </text>
                <text x="145" y="82" text-anchor="middle" fill="#64748b" font-size="11" font-family="Liberation Sans, Arial, sans-serif">
                    of CPU time daily
                </text>
                <text x="145" y="100" text-anchor="middle" fill="#94a3b8" font-size="10" font-family="Liberation Sans, Arial, sans-serif">
                    (1ms × 10M requests)
                </text>

                <!-- Impact annotation -->
                <text x="110" y="145" text-anchor="middle" fill="#dc2626" font-size="12" font-weight="600" font-family="Liberation Sans, Arial, sans-serif">
                    Not harmless at scale
                </text>
            </g>

            <!-- Bottom section: Key insight -->
            <g transform="translate(40, 260)">
                <!-- Divider line -->
                <line x1="0" y1="0" x2="720" y2="0" stroke="#e2e8f0" stroke-width="2"/>

                <!-- Section title -->
                <text x="360" y="30" text-anchor="middle" fill="#1e293b" font-size="14" font-weight="600" font-family="Liberation Sans, Arial, sans-serif">
                    Where Auth Time Goes
                </text>

                <!-- Timeline breakdown -->
                <g transform="translate(60, 50)">
                    <!-- Base timeline -->
                    <rect x="0" y="20" width="600" height="50" rx="6" fill="#f1f5f9"/>

                    <!-- Segments with labels -->
                    <!-- Token parsing -->
                    <rect x="0" y="20" width="80" height="50" rx="6" fill="#6366f1"/>
                    <text x="40" y="50" text-anchor="middle" fill="#ffffff" font-size="10" font-weight="600" font-family="Liberation Sans, Arial, sans-serif">Parse</text>

                    <!-- Signature verification -->
                    <rect x="80" y="20" width="200" height="50" fill="#8b5cf6"/>
                    <text x="180" y="50" text-anchor="middle" fill="#ffffff" font-size="10" font-weight="600" font-family="Liberation Sans, Arial, sans-serif">Signature Verification</text>

                    <!-- Claims check -->
                    <rect x="280" y="20" width="120" height="50" fill="#a855f7"/>
                    <text x="340" y="50" text-anchor="middle" fill="#ffffff" font-size="10" font-weight="600" font-family="Liberation Sans, Arial, sans-serif">Claims Check</text>

                    <!-- Cache lookup -->
                    <rect x="400" y="20" width="100" height="50" fill="#c084fc"/>
                    <text x="450" y="50" text-anchor="middle" fill="#ffffff" font-size="10" font-weight="600" font-family="Liberation Sans, Arial, sans-serif">Cache Lookup</text>

                    <!-- IDP call (optional) -->
                    <rect x="500" y="20" width="100" height="50" rx="0 6 6 0" fill="#e879f9" stroke="#d946ef" stroke-width="2" stroke-dasharray="4,2"/>
                    <text x="550" y="45" text-anchor="middle" fill="#ffffff" font-size="10" font-weight="600" font-family="Liberation Sans, Arial, sans-serif">IDP Call</text>
                    <text x="550" y="58" text-anchor="middle" fill="#fce7f3" font-size="10" font-family="Liberation Sans, Arial, sans-serif">(cache miss)</text>

                    <!-- Time markers -->
                    <text x="40" y="90" text-anchor="middle" fill="#64748b" font-size="10" font-family="Liberation Sans, Arial, sans-serif">~0.1ms</text>
                    <text x="180" y="90" text-anchor="middle" fill="#64748b" font-size="10" font-family="Liberation Sans, Arial, sans-serif">~0.5ms (RSA) / ~0.05ms (HMAC)</text>
                    <text x="340" y="90" text-anchor="middle" fill="#64748b" font-size="10" font-family="Liberation Sans, Arial, sans-serif">~0.1ms</text>
                    <text x="450" y="90" text-anchor="middle" fill="#64748b" font-size="10" font-family="Liberation Sans, Arial, sans-serif">~0.2ms</text>
                    <text x="550" y="90" text-anchor="middle" fill="#dc2626" font-size="10" font-weight="600" font-family="Liberation Sans, Arial, sans-serif">+5-50ms!</text>
                </g>
            </g>

            <!-- Footer subtitle -->
            <text x="400" y="425" text-anchor="middle" fill="#64748b" font-size="13" font-style="italic" font-family="Liberation Sans, Arial, sans-serif">
                Chapter 11: Authentication Performance
            </text>
        </svg>
    </div>
</body>
</html>
