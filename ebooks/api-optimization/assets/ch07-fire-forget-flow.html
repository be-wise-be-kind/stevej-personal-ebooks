<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fire-and-Forget Data Flow</title>
    <style>
        body {
            font-family: Liberation Sans, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8fafc;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .diagram-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 24px;
            max-width: 100%;
        }
        svg {
            display: block;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="diagram-container">
        <svg viewBox="0 0 800 380" xmlns="http://www.w3.org/2000/svg">
            <!-- Background -->
            <rect width="800" height="380" fill="white"/>

            <!-- Title -->
            <text x="400" y="30" text-anchor="middle" style="font-size: 18px; font-weight: 600; fill: #1e293b;" font-family="Liberation Sans, Arial, sans-serif">Fire-and-Forget Pattern</text>

            <!-- Timeline labels -->
            <text x="50" y="75" text-anchor="start" style="font-size: 12px; fill: #64748b; font-weight: 500;" font-family="Liberation Sans, Arial, sans-serif">Time â†’</text>

            <!-- Participants -->
            <rect x="100" y="90" width="80" height="35" fill="#3b82f6" rx="6"/>
            <text x="140" y="112" text-anchor="middle" style="font-size: 11px; fill: white; font-weight: 600;" font-family="Liberation Sans, Arial, sans-serif">Client</text>

            <rect x="280" y="90" width="80" height="35" fill="#22c55e" rx="6"/>
            <text x="320" y="112" text-anchor="middle" style="font-size: 11px; fill: white; font-weight: 600;" font-family="Liberation Sans, Arial, sans-serif">API Server</text>

            <rect x="460" y="90" width="80" height="35" fill="#f59e0b" rx="6"/>
            <text x="500" y="112" text-anchor="middle" style="font-size: 11px; fill: white; font-weight: 600;" font-family="Liberation Sans, Arial, sans-serif">Buffer/Queue</text>

            <rect x="640" y="90" width="80" height="35" fill="#8b5cf6" rx="6"/>
            <text x="680" y="112" text-anchor="middle" style="font-size: 11px; fill: white; font-weight: 600;" font-family="Liberation Sans, Arial, sans-serif">Durable Store</text>

            <!-- Lifelines -->
            <line x1="140" y1="125" x2="140" y2="340" stroke="#cbd5e1" stroke-width="2" stroke-dasharray="5,3"/>
            <line x1="320" y1="125" x2="320" y2="340" stroke="#cbd5e1" stroke-width="2" stroke-dasharray="5,3"/>
            <line x1="500" y1="125" x2="500" y2="340" stroke="#cbd5e1" stroke-width="2" stroke-dasharray="5,3"/>
            <line x1="680" y1="125" x2="680" y2="340" stroke="#cbd5e1" stroke-width="2" stroke-dasharray="5,3"/>

            <!-- Step 1: Analytics event -->
            <line x1="145" y1="150" x2="315" y2="150" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrowBlue)"/>
            <text x="230" y="145" text-anchor="middle" style="font-size: 10px; fill: #3b82f6; font-weight: 500;" font-family="Liberation Sans, Arial, sans-serif">POST /analytics</text>

            <!-- Step 2: Buffer write -->
            <rect x="300" y="160" width="40" height="25" fill="#dcfce7" rx="3"/>
            <line x1="325" y1="185" x2="495" y2="185" stroke="#22c55e" stroke-width="2" marker-end="url(#arrowGreen)"/>
            <text x="410" y="180" text-anchor="middle" style="font-size: 10px; fill: #22c55e; font-weight: 500;" font-family="Liberation Sans, Arial, sans-serif">Enqueue event</text>
            <text x="410" y="195" text-anchor="middle" style="font-size: 9px; fill: #64748b;" font-family="Liberation Sans, Arial, sans-serif">(~1ms)</text>

            <!-- Step 3: Immediate response -->
            <line x1="315" y1="215" x2="145" y2="215" stroke="#22c55e" stroke-width="2" marker-end="url(#arrowGreenLeft)"/>
            <text x="230" y="210" text-anchor="middle" style="font-size: 10px; fill: #22c55e; font-weight: 500;" font-family="Liberation Sans, Arial, sans-serif">200 OK</text>
            <text x="230" y="225" text-anchor="middle" style="font-size: 9px; fill: #64748b;" font-family="Liberation Sans, Arial, sans-serif">(~5ms total)</text>

            <!-- Loss window annotation -->
            <rect x="375" y="235" width="250" height="55" fill="#fef3c7" rx="6" stroke="#f59e0b" stroke-width="2" stroke-dasharray="4,2"/>
            <text x="500" y="255" text-anchor="middle" style="font-size: 10px; fill: #92400e; font-weight: 600;" font-family="Liberation Sans, Arial, sans-serif">Potential Loss Window</text>
            <text x="500" y="270" text-anchor="middle" style="font-size: 9px; fill: #92400e;" font-family="Liberation Sans, Arial, sans-serif">Event acknowledged but not yet durable</text>
            <text x="500" y="283" text-anchor="middle" style="font-size: 9px; fill: #92400e;" font-family="Liberation Sans, Arial, sans-serif">Process crash = data loss</text>

            <!-- Step 4: Async flush -->
            <line x1="505" y1="300" x2="675" y2="300" stroke="#f59e0b" stroke-width="2" marker-end="url(#arrowAmber)"/>
            <text x="590" y="295" text-anchor="middle" style="font-size: 10px; fill: #f59e0b; font-weight: 500;" font-family="Liberation Sans, Arial, sans-serif">Batch flush</text>
            <text x="590" y="315" text-anchor="middle" style="font-size: 9px; fill: #64748b;" font-family="Liberation Sans, Arial, sans-serif">(every 1-5 sec)</text>

            <!-- Step 5: Durable write -->
            <rect x="660" y="305" width="40" height="25" fill="#ddd6fe" rx="3"/>
            <text x="680" y="322" text-anchor="middle" style="font-size: 9px; fill: #7c3aed;" font-family="Liberation Sans, Arial, sans-serif">Write</text>

            <!-- Comparison box -->
            <rect x="50" y="340" width="320" height="35" fill="#f1f5f9" rx="4"/>
            <text x="210" y="358" text-anchor="middle" style="font-size: 10px; fill: #374151; font-weight: 500;" font-family="Liberation Sans, Arial, sans-serif">Synchronous write: 20-50ms latency</text>
            <text x="210" y="370" text-anchor="middle" style="font-size: 10px; fill: #22c55e; font-weight: 500;" font-family="Liberation Sans, Arial, sans-serif">Fire-and-forget: 5ms latency (4-10x faster)</text>

            <!-- Trade-off box -->
            <rect x="430" y="340" width="320" height="35" fill="#fef2f2" rx="4"/>
            <text x="590" y="358" text-anchor="middle" style="font-size: 10px; fill: #991b1b; font-weight: 500;" font-family="Liberation Sans, Arial, sans-serif">Trade-off: ~0.01-0.1% potential data loss</text>
            <text x="590" y="370" text-anchor="middle" style="font-size: 10px; fill: #64748b;" font-family="Liberation Sans, Arial, sans-serif">Acceptable for analytics, telemetry, logs</text>

            <!-- Arrow markers -->
            <defs>
                <marker id="arrowBlue" markerWidth="8" markerHeight="8" refX="7" refY="3" orient="auto" markerUnits="strokeWidth">
                    <path d="M0,0 L0,6 L9,3 z" fill="#3b82f6"/>
                </marker>
                <marker id="arrowGreen" markerWidth="8" markerHeight="8" refX="7" refY="3" orient="auto" markerUnits="strokeWidth">
                    <path d="M0,0 L0,6 L9,3 z" fill="#22c55e"/>
                </marker>
                <marker id="arrowGreenLeft" markerWidth="8" markerHeight="8" refX="0" refY="3" orient="auto" markerUnits="strokeWidth">
                    <path d="M9,0 L9,6 L0,3 z" fill="#22c55e"/>
                </marker>
                <marker id="arrowAmber" markerWidth="8" markerHeight="8" refX="7" refY="3" orient="auto" markerUnits="strokeWidth">
                    <path d="M0,0 L0,6 L9,3 z" fill="#f59e0b"/>
                </marker>
            </defs>
        </svg>
    </div>
</body>
</html>
